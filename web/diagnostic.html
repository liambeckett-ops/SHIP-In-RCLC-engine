<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solvine Web Server Diagnostic</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        h1 { color: #fff; text-align: center; margin-bottom: 30px; }
        .test-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .status { font-weight: bold; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { opacity: 0.9; }
        .links {
            text-align: center;
            margin-top: 30px;
        }
        .links a {
            color: white;
            text-decoration: none;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 8px;
            margin: 0 10px;
            display: inline-block;
        }
        .links a:hover { background: rgba(255,255,255,0.3); }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Solvine Web Server Diagnostic</h1>
        
        <div class="test-section">
            <h3>üåê Current URL Information</h3>
            <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
            <p><strong>Expected URL:</strong> http://localhost:8080</p>
            <p><strong>Protocol:</strong> <span id="protocol"></span></p>
            <p><strong>Host:</strong> <span id="host"></span></p>
            <p><strong>Port:</strong> <span id="port"></span></p>
        </div>

        <div class="test-section">
            <h3>üß™ API Connectivity Tests</h3>
            <button onclick="testHealth()">Test Health Check</button>
            <button onclick="testAPI()">Test API Endpoints</button>
            <button onclick="testAgents()">Test Agent List</button>
            <button onclick="testStatus()">Test System Status</button>
            <div id="results"></div>
        </div>

        <div class="test-section">
            <h3>üìÇ File Access Test</h3>
            <p>This diagnostic page proves the web server is working.</p>
            <p class="status success">‚úÖ Web server is serving HTML files correctly</p>
            <p class="status success">‚úÖ Static file routing is functional</p>
        </div>

        <div class="links">
            <a href="/">üè† Main Interface</a>
            <a href="/docs">üìñ API Docs</a>
            <a href="/agents">ü§ñ Agents JSON</a>
            <a href="/status">üìä Status JSON</a>
        </div>
    </div>

    <script>
        // Display current URL info
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('host').textContent = window.location.hostname;
        document.getElementById('port').textContent = window.location.port || '(default)';

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        async function testHealth() {
            addResult('‚ù§Ô∏è Testing basic server health...', 'warning');
            
            try {
                addResult(`üîç Testing: ${window.location.origin}/health`, 'info');
                const response = await fetch('/health');
                addResult(`üìä Response status: ${response.status}`, 'info');
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ Server is healthy: ${data.service} v${data.version}`, 'success');
                    addResult(`üïê Server time: ${data.timestamp}`, 'info');
                } else {
                    addResult(`‚ùå Health check failed: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå Health check failed: ${error.message}`, 'error');
                addResult(`üí° This means the server is not running or not accessible`, 'warning');
            }
        }

        async function testAPI() {
            addResult('üß™ Testing basic API connectivity...', 'warning');
            
            try {
                addResult(`üîç Testing: ${window.location.origin}/docs`, 'info');
                const response = await fetch('/docs');
                addResult(`üìä Response status: ${response.status}`, 'info');
                addResult(`üìä Response type: ${response.headers.get('content-type')}`, 'info');
                
                if (response.ok) {
                    addResult('‚úÖ API documentation endpoint accessible', 'success');
                } else {
                    addResult(`‚ùå API docs returned: ${response.status} ${response.statusText}`, 'error');
                    const responseText = await response.text();
                    addResult(`üìÑ Response body: ${responseText.substring(0, 200)}...`, 'info');
                }
            } catch (error) {
                addResult(`‚ùå API test failed: ${error.message}`, 'error');
                addResult(`üîç Error details: ${error.stack || 'No stack trace'}`, 'info');
            }
        }

        async function testAgents() {
            addResult('ü§ñ Testing agent list endpoint...', 'warning');
            
            try {
                addResult(`üîç Testing: ${window.location.origin}/agents`, 'info');
                const response = await fetch('/agents');
                addResult(`üìä Response status: ${response.status}`, 'info');
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ Found ${data.total_count || data.agents?.length || 0} agents`, 'success');
                    addResult(`üìã Agent names: ${data.agents?.map(a => a.name).join(', ') || 'None'}`, 'info');
                } else {
                    addResult(`‚ùå Agents endpoint returned: ${response.status} ${response.statusText}`, 'error');
                    const responseText = await response.text();
                    addResult(`üìÑ Response body: ${responseText.substring(0, 200)}...`, 'info');
                }
            } catch (error) {
                addResult(`‚ùå Agents test failed: ${error.message}`, 'error');
            }
        }

        async function testStatus() {
            addResult('üìä Testing system status endpoint...', 'warning');
            
            try {
                addResult(`üîç Testing: ${window.location.origin}/status`, 'info');
                const response = await fetch('/status');
                addResult(`üìä Response status: ${response.status}`, 'info');
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ System uptime: ${data.uptime || 'Unknown'}`, 'success');
                    addResult(`‚úÖ Agent count: ${data.agents_count || 0}`, 'success');
                    addResult(`‚úÖ System stability: ${data.system_stability || 'Unknown'}`, 'success');
                } else {
                    addResult(`‚ùå Status endpoint returned: ${response.status} ${response.statusText}`, 'error');
                    const responseText = await response.text();
                    addResult(`üìÑ Response body: ${responseText.substring(0, 200)}...`, 'info');
                }
            } catch (error) {
                addResult(`‚ùå Status test failed: ${error.message}`, 'error');
            }
        }

        // Auto-run basic test
        window.addEventListener('load', () => {
            addResult('üéØ Diagnostic page loaded successfully', 'success');
            
            if (window.location.hostname !== 'localhost') {
                addResult('‚ö†Ô∏è Not accessing via localhost - this may cause issues', 'warning');
            }
            
            if (window.location.port !== '8080') {
                addResult(`‚ö†Ô∏è Port is ${window.location.port}, expected 8080`, 'warning');
            }
        });
    </script>
</body>
</html>
